name: Docs Check

on:
  pull_request:
    types: [opened, synchronize, reopened, edited]

jobs:
  docs-check:
    runs-on: ubuntu-latest
    permissions:
      pull-requests: read

    steps:
      - name: Check docs requirements
        uses: actions/github-script@ed597411d8f924073f98dfc5c65a23a2325f34cd # v8
        with:
          script: |
            if (/\[x\].*no docs needed/i.test(context.payload.pull_request.body || '')) {
              core.info('ğŸŸ¡ "No Docs Needed" checked â€” skipping docs enforcement.');
              return;
            }
            
            if (context.payload.pull_request.user.login === 'renovate[bot]') {
              core.info('ğŸ¤– Renovate PR detected â€” skipping docs enforcement.');
              return;
            }
            
            const filenames = (await github.rest.pulls.listFiles({
              owner: context.repo.owner,
              repo: context.repo.repo,
              pull_number: context.payload.pull_request.number
            })).data.map(f => f.filename);
            
            if (filenames.some(f => f.startsWith('docs/stable/'))) {
              core.setFailed('âŒ Changes to "stable" documentation are not allowed. Please make changes in the "development" directory instead.');
              return;
            }
            
            if (filenames.some(f => /\.mdx?$/.test(f))) {
              core.info('âœ… Docs updated.');
            } else {
              core.setFailed('âŒ No docs changes found and "No Docs Needed" not checked.');
            }
