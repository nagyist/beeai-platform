name: 'Setup environment'
description: 'Set up mise tools (Python, Node.js, ...) and install project dependencies'

runs:
  using: "composite"
  steps:
    - name: Cache uv .venv
      uses: actions/cache@cdf6c1fa76f9f475f3d7449005a359c84ca0f306 # v5
      with:
        path: /tmp/.uv-cache
        key: uv-cache-v1-${{ runner.os }}-${{ hashFiles('**/uv.lock') }}
        restore-keys: uv-cache-v1-${{ runner.os }}-

    - name: Cache pnpm store
      uses: actions/cache@cdf6c1fa76f9f475f3d7449005a359c84ca0f306 # v5
      with:
        path: ~/.local/share/pnpm/store
        key: pnpm-store-v1-${{ runner.os }}-${{ hashFiles('pnpm-lock.yaml') }}
        restore-keys: pnpm-store-v1-${{ runner.os }}-

    - name: Cache Next.js cache
      uses: actions/cache@cdf6c1fa76f9f475f3d7449005a359c84ca0f306 # v5
      with:
        path: ${{ github.workspace }}/**/.next/cache
        key: nextjs-cache-v1-${{ runner.os }}-${{ hashFiles('pnpm-lock.yaml') }}-${{ hashFiles('**/*.js', '**/*.jsx', '**/*.ts', '**/*.tsx') }}
        restore-keys: |
          nextjs-cache-v1-${{ runner.os }}-${{ hashFiles('pnpm-lock.yaml') }}-
          nextjs-cache-v1-${{ runner.os }}-

    - name: Set environment variables
      shell: bash
      run: |
        echo "UV_FROZEN=true" >> $GITHUB_ENV
        echo "UV_CACHE_DIR=/tmp/.uv-cache" >> $GITHUB_ENV

    - uses: jdx/mise-action@9b0f77b0f21431931f7146a88eb076aa9e335240
      with:
        version: 2026.2.20
